<head>
  <title>B&B Shuffle | Engine-V1</title>
  <link rel="stylesheet" href="styles.css" >
  <link rel="stylesheet" href="builder-styles.css" >
  <link rel="stylesheet" href="deck-styles.css" >
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css2?family=Architects+Daughter&family=Ubuntu:wght@300&display=swap" rel="stylesheet">
  <script src="https://code.jquery.com/jquery-3.5.1.js" integrity="sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc=" crossorigin="anonymous"></script>
  <link href="lightbox.css" rel="stylesheet" />
  
    </head>
  <div id="viewrec">
   B&B Shuffle - Engine-V1 <div id="version">Card list: </div><div id="date">Rev Date: </div>
      <button id="deckselectoropen" class="open-button" onclick="opendeckselector()">Choose Deck</button>
  </div>
  <div class="form-popup" id="myForm">
          <form class="form-container" onsubmit="updatedeck(deck.value);">
              Available Decks: <br>
              <input type="radio" id="corev22" name="deck" value="CoreV22" ><label for="corev22">CoreV2.2</label><br>
              <input type="radio" id="expansion12" name="deck" value="Expansion1-2" ><label for="expansion12">Expansion 1.2</label><br>
              <input type="radio" id="huntress" name="deck" value="Huntress" ><label for="huntress">Huntress Deck</label><br>
              <input type="radio" id="icsotV1" name="deck" value="ICSOT" ><label for="icsotV1">ICS/OTv1</label><br>
              <input type="radio" id="cloudSecurity" name="deck" value="Cloud Security" ><label for="cloudSecurity">Cloud Security</label><br>
              <input type="radio" id="redCanary" name="deck" value="Red Canary"><label for="redCanary">Red Canary</label><br>
              <br>
          <button type="submit" class="btn" >Submit</button>
          <button type="button" class="btn cancel" onclick="closedeckselector()">Close Deck Selector</button>
          </form>
      </div>
  <!--recommendations-->
  <div id="viewrecright">
   Best viewed at 1920x1080
   <br>
  </div>
  <div id="solution">
    DM Controls/Toggles:
    <button onclick="diceboxtoggle()"> D20</button>
    <button onclick="notestoggle()"> Notes</button>
    |
    <button onclick="initinjectstoggle() ">Starting Condition</button>
    <button onclick="injectstoggle()"> Injects</button>
    <button id="consultantButton" onclick="consultantToggle()"> Consultants </button>
    |
  
  
    <button onclick="solutiontoggle()"> Solution</button>
    <button id="addonbuttonSolution" onclick="addonsolutiontoggle()">Add-On Solution</button>
    
    <button onclick="scenariotoggle()">Scenario Tools</button>
    
    <div id="dm_solution" style="display:none;">
        <div class="solution" id="dma"><div class="warn">No Initial Compromise</div></div>
        <div class="solution" id="dmb"><div class="warn">No Pivot & Escalate</div></div>
        <div class="solution" id="dmc"><div class="warn">No C2 & Exfil</div></div>
        <div class="solution" id="dmd"><div class="warn">No Persistence</div></div>
    </div>

    <div id="dm_addonsolution" style="display:none;">
      <div class="addonsol" id="solIC"></div>
      <div class="addonsol" id="solPE"></div>
      <div class="addonsol" id="solCE"></div>
      <div class="addonsol" id="solPER"></div>
</div>

     <div id="dm_scenario" style="display:none;">
         Scenario Tools:
          <button onClick="rando()">Random</button>
          <button onClick="customtoggle()">Custom</button> |
          <button onclick="flipBack()"> Flip Scenario</button>
          <button id="addonbutton" onclick="addonscenariotoggle()">Add-On Scenario</button>
          <button onClick='window.location.href=window.location.href'>Refresh Page</button>
     </div>
  </div>
  
  <!-- Scenario Builder Menu -->
  <div id="builder">
      Scenario Builder
      <button onclick="boxtoggle('ic');buildscenemenu('ic');">Initial Compromise</button>
      <button onclick="boxtoggle('pv');buildscenemenu('pv');">Pivot</button>
      <button onclick="boxtoggle('c2');buildscenemenu('c2');">C2</button>
      <button onclick="boxtoggle('ps');buildscenemenu('ps');">Persist</button>
      |
      <button onclick="boxtoggle('proc');buildprocmenu();">Procedures</button>
      <button onclick="boxtoggle('start');buildinjmenu();">Starting Cond</button>
      |
      <input type="checkbox" id="forAddOn" name="Add-On" value="false">
      <label for="forAddOn" id="forAddOnLabel" checked="false">For Add On</label>
      
      <button onClick="customtoggle()">Close</button>
      <div id="ic">Inital Compromise</div>
      <div id="pv">Pivot</div>
      <div id="c2">C2 & Exfil</div>
      <div id="ps">Persist</div>
      <div id="proc">Procedures</div>
      <div id="start">Starting Condition</div>
  </div>
  
  <!-- SCENARIO CARDS -->
  <header>
  <h1 tabindex="0" class="title">SCENARIO</h1></header>
      <section class="cards">
  
        
  
        <div class="cards__single">
          <div id="inita" class="cards__front">
  
          </div>
          <div class="cards__back">
            <div class='init' id="a">
            </div>
  
          </div>
        </div>
  
        <div class="cards__single">
          <div id="initb"  class="cards__front">
  
          </div>
          <div class="cards__back">
            <div class='init' id="b">
  
            </div>
          </div>
        </div>
  
       
        <div class="cards__single">
          <div id="initc"  class="cards__front">
  
          </div>
          <div class="cards__back">
            <div class='init' id="c">
            </div>
          </div>
        </div>
  
        
        <div class="cards__single">
          <div id="initd"  class="cards__front">
  
          </div>
          <div class="cards__back">
            <div class='init' id="d">
  
            </div>
          </div>
        </div>
  
  <br>
  
  
      </section>

      <!--EXPANSION SCENARIO ADDONS-->
<div id="addonscenario">
  <div id="addonscenarioheader">
    <header>
      <h1 tabindex="0" id="title">ADD-ON SCENARIO</h1></header>
    </div>
        <button id="buttIC" onclick="addIC()"> Add Initial Compromise</button><button id="clearIC" onclick="clear_ic()"> Clear Initial Compromise</button>
        <button id="buttPE" onclick="addPE()"> Add Pivot & Escalate</button><button id="clearPE" onclick="clear_pe()"> Clear P&E</button>
        <button id="buttCE" onclick="addCE()"> Add C2 & EXFIL</button><button id="clearCE" onclick="clear_ce()"> Clear C2 & Exfil</button>
        <button id="buttPER" onclick="addPER()"> Add Persist</button><button id="clearPER" onclick="clear_per()"> Clear Persist</button>
        |
        <button onclick="flipBackAddOn()"> Flip Add-On Cards</button>

    <section class="expcards">
        <div class="addons" id="addIC"></div>
        <div class="addons" id="addPE"></div>
        <div class="addons" id="addCE"></div>
        <div class="addons" id="addPER"></div>
    </section>
  <br>
</div>
<!-- END EXPANSION ADDONS-->
  

<br>
<br>
<br>
<br>
<br>
  <!-- PROCEDURE CARDS -->
  <header>
  <center>
    <h1 tabindex="0" class="title">PROCEDURES</h1></header>
  
  Established Procedures: 
      <div class="establishedprocs" id="output"></div>
      <div style="clear:both; margin-bottom:10px;"></div>
  Other Procedures: 
      <div class="otherprocs" id="remainder"></div>
  </center>
  <div style="clear:both; margin-bottom:10px;"></div>
  
  <!--INJECT BOX-->
  <div id="injectdiv">
      <div id="injectdivheader">
      <header>
        <h1 tabindex="0" class="title">INJECTS</h1></header>
      </div>
      <div id="something"></div>
      <input type="button" onclick="update_ins()" value="DRAW INJECT"/>
      <input type="button" onclick="rem_ins()" value="CLEAR"/>
      <div >
          <div  id="e">
  
          </div>
      </div>
  </div>
  
  
  <!-- INIT INJECT -->
  <div id="initinject">
    <div id="initinjectheader">
      <header>
      <h2 tabindex="0" >Starting Condition</h2></header></div>
      <div class="initinject" id="injectbox">
          <button onClick="randcondition()">Random Condition</button> <button onClick="customtoggle();boxtoggle('start');buildinjmenu()">Custom Condition</button>
      </div>
  </div>
</br>
  <!--Consultant BOX-->
<div id="consultantdiv">
  <div id="consultantdivheader">
  <header>
    <h1 tabindex="0" id="title">CONSULTANTS</h1></header>
  </div>
  <div id="something"></div>
  <input type="button" onclick="update_con()" value="DRAW CONSULTANT"/>
  <input type="button" onclick="rem_con()" value="CLEAR"/>
  <div >
      <div  id="f">
          <img style="width:200px;" src="img/bb-back-consultant.png">
      </div>
  </div>
</div>


<!-- CONSULTANT INIT 
<div id="initconsultant">
  <div id="initconsultantheader">
    <header>
    <h2 tabindex="0" >Starting Condition</h2></header></div>
    <div class="initconsultant" id="consultantbox">
        <button onClick="()">Random Condition</button> <button onClick="customtoggle();boxtoggle('start');buildinjmenu()">Custom Condition</button>
    </div>
</div> -->
  
      <!-- FLIP SCRIPT-->
      <script type="text/javascript" src="flip-script.js"></script>
  
      <!-- CARD SCRIPT-->
      <script type="text/javascript" src="card-script.js"></script>
  
  <hr>
  
  <!-- Game Progress -->
  <div id="mydiv">
    <div id="mydivheader">
      <header>
      <h1 tabindex="0" >GAME PROGRESS</h1></header></div>
            <span id="button"><input type="button" onclick="roll_dice(0)" value="Roll Dice"/></span>
            <span id="button2"><input type="button" onclick="roll_dice(3)" value="Roll Dice (+3)"/></span>
            <span id="button3"><button onClick='addturn()'>Add Extra Turn</button></span>
            <span id="button4"><button onClick='removeturn()'>Remove Turn</button></span>
      <div class="dice" id="dice_box">
          <div id="dice">
  
          </div>
          <div id="message"></div>
          <div id="fails"></div>
      </div>
      <hr>
      <div class="turn">TURNS REMAINING#:
          <div id="turn">10</div>
          <div id="turn_message"></div>
        </div>
  
        <div id="endgame"></div>
  </div>
  
  <!-- Game Progress -->
  <div id="dicebox">
    <div id="diceboxheader">
      <header>
      <h1 tabindex="0" >DiceBox</h1></header></div>
            <span id="button"><input type="button" onclick="roll_d20(0)" value="Roll D20"/></span>
            <span id="button3"></span>
      <div class="dice" id="dice_box">
          <div id="d20">
          </div>
      </div>
  </div>
  
  <!-- GM Notes -->
  <div id="gmnotes">
    <div id="gmnotesheader">
      <header>
      <h1 tabindex="0" >NOTES</h1></header></div>
      <hr>
      <textarea id="notes" rows="2" cols="13">((Type Here))
    </textarea>
        <div id="endgame"></div>
  </div>
  
  
  <!-- COUNTERS -->
  <div id="counter1" class="counter">1</div>
  <div id="counter2" class="counter">2</div>
  <div id="counter3" class="counter">3</div>
  
  <!-- HOLD COUNTER -->
  <div id="hold1" class="xcounter">x</div>
  <div id="hold2" class="xcounter">x</div>
  <div id="hold3" class="xcounter">x</div>
  
  
  <!-- ATTRIBUTION -->
   <div id="copyright" class="cards">
  
   </div>
  
  
  
  <script src="lightbox.js"></script>
    <!-- DICE SCRIPT-->
  <script type="text/javascript" src="dice-script.js"></script>
  <script type="text/javascript" src="ui-script.js"></script>
  <script type="text/javascript" src="ui-builder.js"></script>
  <script type="text/javascript" src="deck-script.js"></script>
  
  
  <script type="text/javascript">

  $('#forAddOn').prop('checked', false); //make sure that the game starts with select add on disabled in custom

    console.log("entered the new script");
    selectedDeck = localStorage.getItem("deckKey");
  
    if (selectedDeck == null)
    {
      selectedDeck = "CoreV22";
      localStorage.setItem("deckKey", "CoreV22");
      console.log("deck is not found/initilized, setting to CoreV22");
    }
  
    function checkBuild() {
    if (finishedBuild === true) {
      //updatedeck(selectedDeck, true);

        //Check if our deck has consultants
      if (hasConsultants === false)
      {
        console.log("Looks like there are not any consultants in this deck");
        $("#consultantButton").hide();

      }
      else{
        $("#consultantButton").show();
        console.log("consultants are present in this deck");
      }
      
      //check for Add-On Scenarios as well
      if (hasAddOns == false)
      {
        $("#addonbutton").hide();
        $("#addonbuttonSolution").hide();
        console.log("no add-on scenarios are present in this deck");
      }


      rando();
    } else {
      setTimeout(checkBuild, 1000);
    }
  }
  
  // Start checking if we finished building
  checkBuild();


  //Deck flip.js from the original code for teh add-on scenario tools
  // VERSION*/
// B&B - Engine.FS.1.1
//

const addOnCards = document.querySelectorAll(".cards__single");

function flipCard() {
this.classList.toggle("flip");
this.setAttribute("state", "flipped");
this.removeEventListener("click", flipCard);
}

addOnCards.forEach((card) => card.addEventListener("click", flipCard));

//You can see full tutorial here
//https://www.ricardomoreira.io/blog/2020-06-15-flip-cards-with-javascript


function flipBack() {
const backs = document.querySelectorAll(".cards__single");
backs.forEach((c) => 
{
	if(c.getAttribute("state")=="flipped")
	{
	c.classList.toggle("flip");
	c.setAttribute("state", "back");
	c.addEventListener("click", flipCard);
 }
});

//card.setAttribute("class", "flipped");
}


//ADD-ON FLIP
function flipBackAddOn() {
const addonbacks = document.querySelectorAll('[class^="cards__single_"]');

addonbacks.forEach((xc) =>
{
	if(xc.getAttribute("state")=="flipped")
	{
	xc.classList.toggle("flip");
	xc.setAttribute("state", "back");
	xc.addEventListener("click", flipCard);
   } else {
   xc.setAttribute("state", "back");
   xc.addEventListener("click", flipCard);
   }


});

}
    
    
  
  </script>
  